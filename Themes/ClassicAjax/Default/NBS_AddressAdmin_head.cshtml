@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightDNN.NBrightRazor>
@using DotNetNuke.Common
@using DotNetNuke.Entities.Portals
@using DotNetNuke.Entities.Users
@using NBrightDNN
@using Nevoweb.DNN.NBrightBuy.Components


@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightBuy/App_LocalResources/")

<link href="/DesktopModules/NBright/NBrightBuy/Themes/ClassicAjax/css/ClientAccount.css" rel="stylesheet">

<!-- fields required to send required ajax cart to server -->
<span id="nbs_addressadminsearch">
    <input id="userid" type="hidden" value="@Model.GetSetting("userid")"></input>
    <input id="razortemplate" type="hidden" value=""></input>
    <input id='editlang' type='hidden' value='@Model.GetUrlParam("language")'></input> <!-- get the current culture and pass to the ajax server side, so it knows what language is -->
    <input id="lang" type="hidden" value="@Model.GetUrlParam("language")"></input> <!-- default to current language -->
    <input id="selecteditemid" type="hidden" value=""></input>    
    <input id="entitytypecode" type="hidden" value="@Model.GetSetting("entitytypecode")" />
    <input id="themefolder" type="hidden" value="@Model.GetSetting("themefolder")" />
</span>

    <script>

        $(document).ready(function() {
            // start load all ajax data, continued by js in product.js file
            $('.processing').show();
            $('#razortemplate').val('NBS_AddressAdminList.cshtml');
            nbxget('addressadmin_getlist', '#nbs_addressadminsearch', '#datadisplay');

            $(document).on("nbxgetcompleted", NBS_OrderAdmin_nbxgetCompleted); // assign a completed event for the ajax calls

            // function to do actions after an ajax call has been made.
            function NBS_OrderAdmin_nbxgetCompleted(e) {

                $('.processing').hide();

                if (e.cmd == 'orderadmin_getlist') {

                    $('#OrderAdmin_searchtext').val($('#searchtext').val());
                    $('#OrderAdmin_datesearchfrom').val($('#dtesearchdatefrom').val());
                    $('#OrderAdmin_datesearchto').val($('#dtesearchdateto').val());
                    $('#OrderAdmin_searchorderstatus').val($('#searchorderstatus').val());

                    // editbutton created by list, so needs to be assigned on each render of list.
                    $('.cmd_vieworder').unbind("click");
                    $('.cmd_vieworder').click(function () {
                        $('.processing').show();
                        $('#razortemplate').val('NBS_OrderAdminDetail.cshtml');
                        $('#selecteditemid').val($(this).attr('itemid'));
                        nbxget('orderadmin_getdetail', '#nbs_orderadminsearch', '#datadisplay');
                    });

                    $('.cmd_repeatorder').unbind("click");
                    $('.cmd_repeatorder').click(function () {
                        $('.processing').show();
                        $('#selecteditemid').val($(this).attr('itemid'));
                        nbxget('orderadmin_reorder', '#nbs_orderadminsearch', '#datadisplay');
                    });

                    $('.cmdPg').unbind("click");
                    $('.cmdPg').click(function () {
                        $('.processing').show();
                        $('#pagenumber').val($(this).attr('pagenumber'));
                        nbxget('orderadmin_getlist', '#nbs_orderadminsearch', '#datadisplay');
                    });

                    $('#OrderAdmin_cmdSearch').unbind("click");
                    $('#OrderAdmin_cmdSearch').click(function () {
                        $('.processing').show();
                        $('#pagenumber').val('1');
                        $('#searchtext').val($('#OrderAdmin_searchtext').val());
                        $('#dtesearchdatefrom').val($('#OrderAdmin_datesearchfrom').val());
                        $('#dtesearchdateto').val($('#OrderAdmin_datesearchto').val());
                        $('#searchorderstatus').val($('#OrderAdmin_searchorderstatus').val());

                        nbxget('orderadmin_getlist', '#nbs_orderadminsearch', '#datadisplay');
                    });

                    $('#OrderAdmin_cmdReset').unbind("click");
                    $('#OrderAdmin_cmdReset').click(function () {
                        $('.processing').show();
                        $('#pagenumber').val('1');
                        $('#searchtext').val('');
                        $('#dtesearchdatefrom').val('');
                        $('#dtesearchdateto').val('');
                        $('#searchorderstatus').val('');

                        nbxget('orderadmin_getlist', '#nbs_orderadminsearch', '#datadisplay');
                    });

                }

                if (e.cmd == 'orderadmin_getdetail') {

                    $('#OrderAdmin_cmdReturn').unbind("click");
                    $('#OrderAdmin_cmdReturn').click(function () {
                        $('.processing').show();
                        $('#razortemplate').val('NBS_OrderAdminList.cshtml');
                        $('#selecteditemid').val('');
                        nbxget('orderadmin_getlist', '#nbs_orderadminsearch', '#datadisplay');
                    });

                    $('#OrderAdmin_cmdReOrder').unbind("click");
                    $('#OrderAdmin_cmdReOrder').click(function () {
                        $('.processing').show();
                        $('#selecteditemid').val($(this).attr('itemid'));
                        nbxget('orderadmin_reorder', '#nbs_orderadminsearch', '#datadisplay');
                    });                    

                }



            };

        });

    </script>

