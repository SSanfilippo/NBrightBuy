@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightRazor>
@using System.Linq
@using DotNetNuke.Entities.Users
@using NBrightDNN
@using Nevoweb.DNN.NBrightBuy.Components;

@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightBuy/App_LocalResources/")

@{
    // assign Model, so we can resolve var in VS
    var product = (ProductData)Model.List.First();
    var info = (NBrightInfo)product.Info;
    var brand = PropertyValue(product, "man", "propertyname").ToString();
    if (brand == "")
    {
        brand = info.GetXmlProperty("genxml/textbox/manufacturer");
    }
}

<!-- JSON-LD markup generated by Google's structured data markup help tool -->
<script type="application/ld+json">
{
  "@@context" : "http://schema.org",
  "@@type" : "Product",
  "name" : "@(product.ProductName)",
  "image" : "http://@WebsiteUrl()@product.Imgs.First().GetXmlProperty(" genxml/hidden/imageurl")",
  "description" : "@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")",
  "url" : "@EntryUrl(info,Model,false,product.SEOName)",
  "brand" : {
    "@@type" : "Brand",
    "name" : "@(brand)"
  },
  "offers" : {
    "@@type" : "Offer",
    "price" : "@(NBrightBuyUtils.FormatToStoreCurrency(product.BestPrice()))"
  }
}
</script>

<!-- Facebook id number for Page Insights - https://www.facebook.com/help/336893449723054 -->
<meta property="fb:app_id" content="[Settings:facebookid]"/>

<!-- Open Graph data for Facebook - https://developers.facebook.com/docs/reference/opengraph/object-type/product/ -->
<meta property="og:type" content="product.item" />
<meta property="og:title" content="@(product.ProductName)" />
<meta property="og:description" content="@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")" />
<meta property="og:image" content="http://@WebsiteUrl()@product.Imgs.First().GetXmlProperty(" genxml/hidden/imageurl")" />
<meta property="og:url" content="@EntryUrl(info,Model,false,product.SEOName)" />
<meta property="og:site_name" content="@Model.GetSetting("portalname")" />
<meta property="product:price:amount" content="@product.FromPrice()">
<meta property="product:price:currency" content="@(NBrightBuyUtils.GetCurrencyIsoCode())">

<!-- Twitter Card - https://dev.twitter.com/docs/cards -->
<meta name="twitter:title" content="@(product.ProductName)" />
<meta name="twitter:card" content="product" />
<meta name="twitter:site" content="@Model.GetSetting("twittersite")" />
<meta name="twitter:creator" content="@Model.GetSetting("twitteruser")" />
<meta name="twitter:domain" content="@WebsiteUrl()" />
<meta name="twitter:description" content="@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")" />
<meta name="twitter:image" content="http://@WebsiteUrl()@product.Imgs.First().GetXmlProperty(" genxml/hidden/imageurl")" />

<!-- Colorbox Lightbox -->
<script type="text/javascript" src="/DesktopModules/NBright/NBrightBuy/Themes/ClassicAjax/js/jquery.colorbox-min.js"></script>
<link href="/DesktopModules/NBright/NBrightBuy/Themes/ClassicAjax/css/colorbox.css" rel="stylesheet">

<script type="text/javascript" src="/DesktopModules/NBright/NBrightBuy/Themes/config/js/nbbajax.js"></script>
<script type="text/javascript" src="/DesktopModules/NBright/NBrightBuy/Themes/ClassicAjax/js/product.js"></script>
<script src="/DesktopModules/NBright/NBrightBuy/Themes/ClassicAjax/js/jquery.cookie.min.js"></script>


<div id="nbs_productajaxview" style="display: none;">
    <!-- Parameter fields -->
    <!-- These fields will be initialized from the _head.cshtml -->
    <input id="userid" type="hidden" value="@UserController.Instance.GetCurrentUserInfo().UserID"/>
    <input id="uilang" type="hidden" value="@Model.Lang"/>
    <input id="themefolder" type="hidden" value="@Model.GetSetting("themefolder")"/>

    <!-- use this to pass itemid that need to be added to favorite/shop list. -->
    <input id="shopitemid" type="hidden" value="@Model.GetUrlParam("shopitemid")"/>
    <input id="shoplistname" type="hidden" value=""/>
    <input id="shopredirectflag" type="hidden" value=""/>

</div>

<input id="logintab" type="hidden" value="@(StoreSettings.Current.Get("logintab"))" />

<!-- Shopping List Popup -->
<div style="display:none;">
  <div id="shoppinglistpopup" class="shoppinglistpopup"></div>
</div>
